{% schema %}
{
  "name": "Custom Quiz",
  "settings": [
    {
      "type": "text",
      "id": "quiz_title",
      "label": "Quiz Title",
      "default": "Find Your Perfect Product"
    },
    {
      "type": "text",
      "id": "quiz_btn",
      "label": "Quiz Button",
      "default": "Start Quiz"
    },
    {
      "type": "color",
      "id": "btn_background_color",
      "label": "Button Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "btn_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "btn_padding",
      "label": "Button Padding",
      "default": "10px 20px"
    },
    {
      "type": "text",
      "id": "btn_border_radius",
      "label": "Button Border Radius",
      "default": "5px"
    },
    {
      "type": "text",
      "id": "font_family",
      "label": "Font Family",
      "default": "Arial, sans-serif"
    },
    {
      "type": "color",
      "id": "font_color",
      "label": "Font Color",
      "default": "#000000"
    },
    {
      "type": "text",
      "id": "font_size",
      "label": "Font Size",
      "default": "16px"
    },
    {
      "type": "color",
      "id": "radio_background_color",
      "label": "Radio Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "radio_border_color",
      "label": "Radio Border Color",
      "default": "#000000"
    },
    {
      "type": "text",
      "id": "radio_size",
      "label": "Radio Size",
      "default": "20px"
    },
    {
      "type": "text",
      "id": "quiz_container_padding",
      "label": "Quiz Container Padding",
      "default": "20px"
    }
  ],
  "blocks": [
    {
      "type": "question",
      "name": "Question",
      "settings": [
        {
          "type": "text",
          "id": "question_text",
          "label": "Question Text"
        },
        {
          "type": "text",
          "id": "answer_1",
          "label": "Answer 1"
        },
        {
          "type": "product_list",
          "id": "recommended_products_1",
          "label": "Recommended Products for Answer 1"
        },
        {
          "type": "text",
          "id": "answer_2",
          "label": "Answer 2"
        },
        {
          "type": "product_list",
          "id": "recommended_products_2",
          "label": "Recommended Products for Answer 2"
        },
        {
          "type": "text",
          "id": "answer_3",
          "label": "Answer 3"
        },
        {
          "type": "product_list",
          "id": "recommended_products_3",
          "label": "Recommended Products for Answer 3"
        },
        {
          "type": "text",
          "id": "answer_4",
          "label": "Answer 4"
        },
        {
          "type": "product_list",
          "id": "recommended_products_4",
          "label": "Recommended Products for Answer 4"
        },
        {
          "type": "text",
          "id": "answer_5",
          "label": "Answer 5"
        },
        {
          "type": "product_list",
          "id": "recommended_products_5",
          "label": "Recommended Products for Answer 5"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Quiz",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<style>
  .quiz-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: {{ section.settings.quiz_container_padding }};
    font-family: {{ section.settings.font_family }};
    color: {{ section.settings.font_color }};
    font-size: {{ section.settings.font_size }};
  }

  .quiz-container h2 {
    font-size: 2em;
    margin-bottom: 20px;
  }

  .quiz-btn {
    background-color: {{ section.settings.btn_background_color }};
    color: {{ section.settings.btn_text_color }};
    padding: {{ section.settings.btn_padding }};
    border-radius: {{ section.settings.btn_border_radius }};
    border: none;
    cursor: pointer;
    margin-bottom: 20px;
  }

  .quiz-question {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-bottom: 20px;
    width: 100%;
  }

  .quiz-answers {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .quiz-block {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .questionInput {
    width: {{ section.settings.radio_size }};
    height: {{ section.settings.radio_size }};
    background-color: {{ section.settings.radio_background_color }};
    border: 2px solid {{ section.settings.radio_border_color }};
  }

  .quiz-answer {
    cursor: pointer;
  }

  .quiz-navigation {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin-top: 20px;
  }

  #quiz-results {
    margin-top: 20px;
    width: 100%;
  }
</style>

<div class="quiz-container" style="padding: {{ section.settings.quiz_container_padding }}; font-family: {{ section.settings.font_family }}; color: {{ section.settings.font_color }}; font-size: {{ section.settings.font_size }};">
  <h2>{{ section.settings.quiz_title }}</h2>
  <button class="quiz-btn" style="background-color: {{ section.settings.btn_background_color }}; color: {{ section.settings.btn_text_color }}; padding: {{ section.settings.btn_padding }}; border-radius: {{ section.settings.btn_border_radius }};">{{ section.settings.quiz_btn }}</button>
  {% for block in section.blocks %}
    {% if block.type == 'question' %}
      <div class="quiz-question" data-question-id="{{ forloop.index }}">
        <h3>{{ block.settings.question_text }}</h3>
        <div class="quiz-answers">
          {% assign answers = "troll,answer_1,answer_2,answer_3,answer_4,answer_5" | split: ',' %}
          {% for i in (0..5) %}
            {% assign answer_key = answers[i] %}
            {% assign answer = block.settings[answer_key] %}
            {% assign products_key = "recommended_products_" | append: i %}
            {% assign recommended_products_list = block.settings[products_key] | json %}

            {% if answer and i != 0 %}
              <script>
                var answerIndex = "{{ forloop.index }}_{{ i }}";
                var recommendedProducts = {{ recommended_products_list }};
                console.log("Answer Group:", answerIndex, "Recommended Products:", recommendedProducts);
              </script>
              <div class="quiz-block">
                <input 
                  class="questionInput" 
                  type="checkbox" 
                  name="question_{{ forloop.index }}" 
                  value="{{ forloop.index }}_{{ i }}" 
                  id="answer_{{ forloop.index }}_{{ i }}" 
                  data-products="{{ recommended_products_list | escape }}"
                  style="background-color: {{ section.settings.radio_background_color }}; border-color: {{ section.settings.radio_border_color }};"
                />
                <label for="answer_{{ forloop.index }}_{{ i }}" class="quiz-answer">{{ answer }}</label>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  {% endfor %}
  <div class="quiz-navigation">
    <button id="prev-question" style="display: none;">Previous</button>
    <button id="next-question">Next</button>
    <button id="submit-quiz" style="display: none;">Submit</button>
  </div>
  <div id="quiz-results" style="display: none;">
    <!-- Results will be displayed here -->
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const quizQuestions = document.querySelectorAll('.quiz-question');
    let currentQuestionIndex = 0;

    function showQuestion(index) {
      quizQuestions.forEach((question, i) => {
        question.style.display = (i === index) ? 'block' : 'none';
      });

      document.getElementById('prev-question').style.display = (index === 0) ? 'none' : 'inline-block';
      document.getElementById('next-question').style.display = (index === quizQuestions.length - 1) ? 'none' : 'inline-block';
      document.getElementById('submit-quiz').style.display = (index === quizQuestions.length - 1) ? 'inline-block' : 'none';
    }

    document.getElementById('next-question').addEventListener('click', function() {
      if (currentQuestionIndex < quizQuestions.length - 1) {
        currentQuestionIndex++;
        showQuestion(currentQuestionIndex);
      }
    });

    document.getElementById('prev-question').addEventListener('click', function() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        showQuestion(currentQuestionIndex);
      }
    });

    document.getElementById('submit-quiz').addEventListener('click', function() {
      document.getElementById('quiz-results').style.display = 'block';
    });

    // Initialize
    showQuestion(currentQuestionIndex);
  });
</script>
